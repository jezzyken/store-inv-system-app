"use strict";(self["webpackChunkvue2"]=self["webpackChunkvue2"]||[]).push([[822],{9822:function(t,e,s){s.r(e),s.d(e,{default:function(){return x}});var a=s(3740),i=s(4414),n=s(3449),l=s(1446),o=s(9483),r=s(6930),c=s(7683),d=s(2756),u=s(4312),m=s(8184),p=s(2498),h=s(1034),v=s(7112),y=function(){var t=this,e=t._self._c;return t.isLoading?t._e():e(n.A,[e(m.A,{staticClass:"pa-5",attrs:{elevation:"1"}},[e("p",{staticClass:"text-button"},[t._v("Product Information")]),e(o.A,{staticClass:"mb-5"}),e(d.A,[e(i.A,{attrs:{cols:"12",md:"6"}},[e(c.A,{ref:"menu1",attrs:{"close-on-content-click":!1,"return-value":t.items.date,transition:"scale-transition","offset-y":"","min-width":"auto"},on:{"update:returnValue":function(e){return t.$set(t.items,"date",e)},"update:return-value":function(e){return t.$set(t.items,"date",e)}},scopedSlots:t._u([{key:"activator",fn:function({on:s,attrs:a}){return[e(v.A,t._g(t._b({attrs:{label:"Date","prepend-inner-icon":"mdi-calendar",readonly:"",outlined:""},model:{value:t.items.date,callback:function(e){t.$set(t.items,"date",e)},expression:"items.date"}},"v-text-field",a,!1),s))]}}],null,!1,2585148267),model:{value:t.menu,callback:function(e){t.menu=e},expression:"menu"}},[e(l.A,{attrs:{"no-title":"",scrollable:""},model:{value:t.items.date,callback:function(e){t.$set(t.items,"date",e)},expression:"items.date"}},[e(h.A),e(a.A,{attrs:{text:"",color:"#000033"},on:{click:function(e){t.menu=!1}}},[t._v(" Cancel ")]),e(a.A,{attrs:{text:"",color:"#000033"},on:{click:function(e){return t.$refs.menu1.save(t.items.date)}}},[t._v(" OK ")])],1)],1)],1),e(i.A,{attrs:{cols:"12",md:"6"}},[e(v.A,{attrs:{label:"Customer",outlined:""},model:{value:t.items.customer,callback:function(e){t.$set(t.items,"customer",e)},expression:"items.customer"}})],1)],1)],1),e(m.A,{staticClass:"pa-5 mt-5",attrs:{elevation:"1"}},[e("p",{staticClass:"text-button"},[t._v("Sales")]),e(o.A,{staticClass:"mb-5"}),e(p.A,{scopedSlots:t._u([{key:"default",fn:function(){return[e("thead",[e("tr",[e("th",{staticClass:"text-left"},[t._v("Product")]),e("th",{staticClass:"text-left"},[t._v("Price")]),e("th",{staticClass:"text-left"},[t._v("Stocks")]),e("th",{staticClass:"text-center"},[t._v("Quantity")]),e("th",{staticClass:"text-left"},[t._v("Sub Total")]),e("th",{staticClass:"text-left"},[t._v("Actions")])])]),e("tbody",t._l(t.items.stocks,(function(s,i){return e("tr",{key:i},[e("td",{staticClass:"pa-5"},[e("span",[t._v(t._s(s.name))])]),e("td",{staticClass:"pa-5"},[e("span",[t._v(t._s(s.sellingPrice))])]),e("td",{staticClass:"pa-5"},[e("span",[t._v(t._s(s.availableStocks))])]),e("td",[e("div",{staticClass:"d-flex justify-center"},[e(a.A,{attrs:{dark:"",color:"#000033",small:"",fab:""},on:{click:function(e){return t.incrementQuantity(i)}}},[e(r.A,[t._v("mdi-plus")])],1),e("div",{staticStyle:{width:"75px"}},[e(v.A,{staticClass:"text-center mx-2",attrs:{outlined:"","hide-details":"",dense:""},on:{input:function(e){return t.updateSubTotal(i)}},model:{value:s.quantity,callback:function(e){t.$set(s,"quantity",e)},expression:"stock.quantity"}})],1),e(a.A,{attrs:{dark:"",color:"#000033",small:"",fab:""},on:{click:function(e){return t.decrementQuantity(i)}}},[e(r.A,[t._v("mdi-minus")])],1)],1)]),e("td",{staticClass:"pa-5"},[e("span",[t._v(t._s(s.subTotal.toFixed(2)))])]),e("td",[e(a.A,{attrs:{dark:"",color:"error",small:""},on:{click:function(e){return t.onDeleteItem(s,i)}}},[e(r.A,[t._v("mdi-trash-can-outline")])],1)],1)])})),0)]},proxy:!0}],null,!1,111216510)}),e(d.A,{staticClass:"mt-5",attrs:{justify:"end"}},[e(p.A,{staticClass:"outside-bordered-table",staticStyle:{width:"30%"},scopedSlots:t._u([{key:"default",fn:function(){return[e("tbody",[e("tr",[e("td",{staticClass:"pa-5"},[e("span",[t._v("Total")])]),e("td",{staticClass:"pa-5"},[e("span",[t._v("P "+t._s(t.salesTotal))])])]),e("tr",[e("td",{staticClass:"pa-5"},[e("span",[t._v("Delivery Fee")])]),e("td",{staticClass:"pa-5"},[e("span",[t._v("P "+t._s(t.deliveryFee))])])]),e("tr",[e("td",{staticClass:"pa-5"},[e("span",[t._v("Discount")])]),e("td",{staticClass:"pa-5"},[e("span",[t._v("P "+t._s(t.discount))])])]),e("tr",[e("td",{staticClass:"pa-5"},[e("span",[t._v("Grand total")])]),e("td",{staticClass:"pa-5"},[e("span",[t._v("P "+t._s(t.grandTotal))])])])])]},proxy:!0}],null,!1,4019076521)})],1)],1),0!=t.items.stocks?e(m.A,{staticClass:"pa-5 mt-5",attrs:{elevation:"1"}},[e(d.A,[e(i.A,{attrs:{cols:"12",md:"3"}},[e(v.A,{attrs:{label:"Discount",outlined:"",disabled:""},model:{value:t.items.discount,callback:function(e){t.$set(t.items,"discount",e)},expression:"items.discount"}})],1),e(i.A,{attrs:{cols:"12",md:"3"}},[e(u.A,{attrs:{label:"Payment",items:t.payment,outlined:"",disabled:""},model:{value:t.items.paymentType,callback:function(e){t.$set(t.items,"paymentType",e)},expression:"items.paymentType"}})],1),e(i.A,{attrs:{cols:"12",md:"3"}},[e(v.A,{attrs:{label:"Cash",outlined:"",disabled:""},on:{input:t.onAddAmount},model:{value:t.items.amountReceived,callback:function(e){t.$set(t.items,"amountReceived",e)},expression:"items.amountReceived"}})],1),e(i.A,{attrs:{cols:"12",md:"3"}},[e(v.A,{attrs:{label:"Change",outlined:"",disabled:""},model:{value:t.items.change,callback:function(e){t.$set(t.items,"change",e)},expression:"items.change"}})],1),e(i.A,{attrs:{cols:"12",md:"12"}},[e(v.A,{attrs:{label:"Notes",outlined:""},model:{value:t.items.notes,callback:function(e){t.$set(t.items,"notes",e)},expression:"items.notes"}})],1)],1)],1):t._e(),e(d.A,{staticClass:"ma-0 mt-6",attrs:{justify:"end"}},[e(a.A,{attrs:{dark:"",color:t.buttonState.color},on:{click:t.buttonState.action}},[t._v(t._s(t.buttonState.label))]),e("div",{staticClass:"ma-1"}),e(a.A,[t._v("clear")])],1)],1)},f=[],b=(s(4114),s(5353)),_=s(5093),k=s.n(_),g={props:{mode:String},data(){return{items:{hasDelivery:null,delivery:{deliveryDate:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},stocks:[],date:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},isLoading:!1,category:[],unit:[],prices:[],brand:[],products:[],stocks:[],variants:[],colors:[],variantColorItems:[],variantId:null,productId:null,payment:["Cash","Dedit"],deleteItemId:[],menu:!1,deliveryDateMenu:!1}},computed:{buttonState(){let t={color:"warning",action:this.onUpdateItem,label:"update"};return"add"===this.mode&&(t={color:"#000033",action:this.onAddItem,label:"add"}),t},salesTotal(){const t=this.items.stocks.reduce(((t,e)=>{const s=parseFloat(e.sellingPrice)*parseInt(e.quantity||0);return t+s}),0);return t.toFixed(2)},grandTotal(){const t=this.items.stocks.reduce(((t,e)=>{const s=parseFloat(e.sellingPrice)*parseInt(e.quantity||0);return t+s}),0);return(t+ +this.deliveryFee-this.discount).toFixed(2)},deliveryFee(){if(this.items.hasDelivery){const t=this.items.delivery.deliveryFee;return t?parseFloat(t).toFixed(2):"0.00"}return"0.00"},discount(){return this.items.discount?parseFloat(this.items.discount).toFixed(2):"0.00"}},async created(){this.fetch(),this.$route?.params?.id&&this.initialize()},methods:{...(0,b.i0)({getProductItems:"product/getItems",getSalesById:"sale/getItemById",getDeliveryBySalesItemId:"delivery/getDeliveryBySalesItemId",addItem:"sale/addItem",updateItem:"sale/updateItem",deleteItem:"stockItem/deleteItem"}),async initialize(){this.isLoading=!0;try{const[t,e]=await Promise.all([this.getSalesById(this.$route.params.id),this.getDeliveryBySalesItemId(this.$route.params.id)]),s=t.result[0];if(console.log(s),e.result.length>0){const t=e.result[0];t.deliveryDate&&(t.deliveryDate=k()(t.deliveryDate).format("YYYY-MM-DD")),Object.assign(this.items.delivery,t)}const a=["date","referenceCode","amountReceived","discount","salesTotal","paymentType","change","discount","grandTotal","hasDelivery","notes","customer"];a.forEach((t=>{"date"===t?this.$set(this.items,t,k()(s[t]).format("YYYY-MM-DD")):this.$set(this.items,t,s[t])}));for(let i of s.items){const t={name:i.product.name,quantity:i.quantity,availableStocks:i.product.stocks,product:i.product._id,_id:i.product._id,items_id:i.item_id,sellingPrice:i.product.price,subTotal:parseFloat(i.product.price)*parseInt(i.quantity||0)};if("Variants"===i.product.type){const e=i.product.variants.find((t=>t._id==i.variant));console.log(e),t.variant=e._id,t.name=e.name,t.availableStocks=e.stocks,t.sellingPrice=e.price,t.subTotal=parseFloat(e.price)*parseInt(i.quantity||0)}this.items.stocks.push(t)}}catch(t){console.error("Error initializing data:",t)}finally{this.isLoading=!1}},async onSelectItem(t){const e={product:t._id,name:t.name,availableStocks:t.availableStocks,sellingPrice:t.sellingPrice,quantity:0,subTotal:0};"Variants"===t.type&&(e.variant=t.variants._id,e.sellingPrice=t.variants.sellingPrice),this.items.stocks.push(e)},async onAddItem(){const t={...this.items,stocks:this.items.stocks,salesTotal:this.salesTotal,grandTotal:this.grandTotal};await this.addItem(t),this.$router.push("/sale")},async onUpdateItem(){const t={id:this.$route?.params?.id,data:{...this.items,salesTotal:this.salesTotal,grandTotal:this.grandTotal,deletedItems:this.deleteItemId}};await this.updateItem(t),this.$router.push("/sale")},async onDeleteItem(t=null,e){this.items.stocks.splice(e,1),t.items_id&&(this.deleteItemId.includes(t.items_id)||this.deleteItemId.push(t.items_id))},async fetch(){const t=await this.getProductItems();this.products=t.result.map((t=>("Variants"===t.type&&(t.name=`${t.name}-${t.variants.name}`,t.productCode=t.variants.productCode),t)))},updateSubTotal(t){const e=this.items.stocks[t];e.subTotal=parseFloat(e.sellingPrice)*parseInt(e.quantity||0)},incrementQuantity(t){this.items.stocks[t].quantity++,this.updateSubTotal(t)},decrementQuantity(t){this.items.stocks[t].quantity>0&&(this.items.stocks[t].quantity--,this.updateSubTotal(t))},onAddAmount(t){"number"===typeof+t&&0!==+t&&+t>=this.grandTotal?this.items.change=t-this.grandTotal:this.items.change=0},onSelectDelivery(t){console.log(t)}}},I=g,A=s(1656),C=(0,A.A)(I,y,f,!1,null,"44f0d0d0",null),x=C.exports}}]);
//# sourceMappingURL=822.356539c9.js.map